<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

  
<mapper namespace="com.decolab.wanza.dao.CardDAO">


<!-- 스토리 글 목록 가져오기 -->
<select id="getCardList" resultType="com.decolab.wanza.dto.CardDTO">
	SELECT CARDSEQ, CARDTITLE, CARDCONTENT, USERSEQ, CARDREADCOUNT, CARDDATE, CARDFILENAME, CARDDEL
	FROM CARD_COLLECTIONS
</select>
  
<!-- 스토리 글 작성 -->
<insert id="cardWrite" parameterType="com.decolab.wanza.dto.CardDTO">
	INSERT INTO CARD_COLLECTIONS
	VALUES (SEQ_CARD.NEXTVAL, #{cardTitle}, #{cardContent}, #{userSeq}, 0, SYSDATE, #{cardFileName}, 0)
</insert>
  
  
<!-- 조회수 1 증가 -->  
<insert id="addCardReadCount" parameterType="com.decolab.wanza.dto.CardDTO">
	UPDATE CARD_COLLECTIONS
	SET CARDREADCOUNT=CARDREADCOUNT+1
	WHERE CARDSEQ=#{}
</insert> 

  
  
<!-- 하트 총 개수 -->  
<select id="getLikeCount" parameterType="com.decolab.wanza.dto.CardDTO" resultType="int">
	SELECT NVL(COUNT(*), 0)
	FROM CARD_FAVORITE
	WHERE CARDSEQ=#{cardSeq}
</select>    
  
<!-- 하트 누른 게시글인지 조회 -->
<select id="boolLike" parameterType="com.decolab.wanza.dto.CardDTO" resultType="int">
	SELECT NVL(COUNT(*), 0)
	FROM CARD_FAVORITE
	WHERE USERSEQ=#{userSeq} AND CARDSEQ=#{cardSeq}
</select>   

<!-- 하트 누름(+1) -->  
<insert id="addCardLikeCount" parameterType="com.decolab.wanza.dto.CardDTO">
	INSERT INTO CARD_FAVORITE
	VALUES (#{userSeq}, #{cardSeq})
</insert>   
  
<!-- 하트 취소 (-1) -->  
<delete id="deleteCardLikeCount" parameterType="com.decolab.wanza.dto.CardDTO">
	DELETE FROM CARD_FAVORITE
	WHERE USERSEQ=#{userSeq} AND CARDSEQ=#{cardSeq}
</delete>     
  
  
  
  
  
  
<!-- 댓글 가져온다 -->
<select id="getCardReviewList" parameterType="com.decolab.wanza.dto.CardReviewDTO" resultType="com.decolab.wanza.dto.CardReviewDTO">
	SELECT CARDREVSEQ, CARDSEQ, NICKNAME, CARDREVCONTENT, CARDREVDATE, CARDREVDEL
	FROM (SELECT ROW_NUMBER()OVER(ORDER BY CARDREVSEQ DESC) AS RNUM, CARDREVSEQ, CARDSEQ, NICKNAME, CARDREVCONTENT, CARDREVDATE, CARDREVDEL FROM CARD_REVIEW WHERE CARDSEQ=#{cardSeq})	
	WHERE RNUM&gt;=1+4*#{cardRevPageNum} AND RNUM&lt;=4+4*#{cardRevPageNum}
</select>  

<!-- 댓글 총 개수 -->
<select id="getCardReviewCount" parameterType="com.decolab.wanza.dto.CardReviewDTO" resultType="int">
	SELECT NVL(COUNT(*), 0)
	FROM CARD_REVIEW
	WHERE CARDSEQ=#{cardSeq} AND CARDREVDEL = 0
</select>

<!-- 댓글 작성 -->
<insert id="cardReviewWrite" parameterType="com.decolab.wanza.dto.CardReviewDTO">
	INSERT INTO CARD_REVIEW
	VALUES (SEQ_REVIEW_CARD.NEXTVAL, #{cardSeq}, #{nickName}, #{cardRevContent}, SYSDATE, 0)
</insert>


  
  
  
  
</mapper>