<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>완벽한 자취생활, 완자 | 이벤트 상세 정보</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link rel="shortcut icon" href="../../assets/img/wanza-Icon.ico" type="image/x-icon">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../../css/style.css">
        <!-- 써머노트 -->
        <link rel="stylesheet" href="../../css/summernote/summernote-lite.css">
        <link rel="stylesheet" href="../../css/summernote/font/summernote.eot">
        <!-- 써머노트 -->
    </head>
    <style>
        #eventWriteBtn{
            margin-left: 15px;
            background: rgb(244, 116, 76);
            color: rgb(255,255,255);
            width: 100%;
            height: 50px;
            margin: 10px;
        }

        input:read-only{
            background-color: #e6e6e6;
        }
    </style>



<body>
    <header include-html="../commons/header.html"></header>
    <nav include-html="../commons/menuComm.html"></nav>

    <div class="row" style="margin-top: 50px; margin-bottom: 100px;">

        <div class="col-xl-3"></div>
        
        <div class="col-xl-6">

            
            <!-- 이벤트 기간 입력 -->
            <form id="eventForm">
                <div class="form-group" style="width: 40%;" id="hideSeq">
                    <input type="text" class="form-control" id="startDate" placeholder="이벤트 시작일을 입력해주세요 ex(2020/04/14)" name="eventStartDate">
                </div>
                    <span>~</span>
                <div class="form-group" style="width: 40%;">
                    <input type="text" class="form-control" id="endDate" placeholder="이벤트 종료일을 입력해주세요 ex(2020/04/15)" name="eventEndDate">               
                </div>
           

            <!-- 이벤트 제목 입력 -->
            <div class="form-group">
                <input type="text" class="form-control" id="eventTitle" placeholder="이벤트 제목을 입력 해 주세요" name="eventTitle">               
            </div>
            <!-- 이벤트 썸네일 -->
           
            <div style="margin-bottom: 10px;">
                <input type="file" name="eventFile1">
            </div>
            
            <!-- 이벤트 내용 사진 -->
            <div>
                <textarea id="eventFile" class="summernote" name="eventContent"></textarea>
            </div>
            <!-- 관련상품 Radio Button -->
            <div style="margin-top: 10px;">
                <span>관련 상품을 등록하시겠습니까 ?</span>
                <div class="form-check-inline">
                    <label class="form-check-label" for="radio1">
                      <input type="radio" class="form-check-input" id="radioYes" name="optradio" value="yes">예                      
                    </label>
                </div>
                <div class="form-check-inline">
                    <label class="form-check-label" for="radio2">
                      <input type="radio" class="form-check-input" id="radioNo" name="optradio" value="no" checked >아니오
                    </label>
                </div> 
            </div>
        </form>
           

            <!-- 상품 이름 검색 -->
            <div id="productNameInput" class="form-group" style="margin-top: 10px;">
                <input type="text" class="form-control" id="productName" placeholder="이름으로 검색해서 상품 찾아오기" onkeyup="if(window.event.keyCode==13){searchProduct()}" style="width: 50%;">               
            </div>

            <!-- 상품 list up -->
            <div class="row" style="text-align: center;" id="_productListUp">  
                                     
            </div>
        
            

             <!-- 글쓰기 완료 버튼 -->
             <div class="row" style="margin-top: 50px;">
                <button id="eventWriteBtn" class="btn" type="button" onclick="completeEvent()">이벤트 작성</button>
            </div>

        
        </div>
  
        


        <div class="col-xl-3"></div>
    </div>

    <footer include-html="../commons/footer.html"></footer>

    <script src="../../assets/js/jquery.min.js"></script>
    <script src="../../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../js/includeHTML.js"></script>
    <script src="../../js/header.js"></script>
    <!-- 써머노트 스크립트 시작 -->
    <script src="../../css/summernote/summernote-lite.js"></script>
    <script src="../../css/summernote/summernote-ko-KR.js"></script>
<script>
    // 상품 검색
    function searchProduct(){
        app ="";
        $("#_productListUp").children().remove();
        $.ajax({
            url:"http://localhost:3000/getSearchProduct",
            type:"get",
            data:{productName:$("#productName").val()},
            success:function(list){

                if(list.length ==0){
                    $("#_productListUp").append("<h3 style='text-align: center; margin-top: 50px;'>찾으시는 상품이 없습니다</h3>" );
                }else{
                    $.each(list,function(i,val){
                        app+="<div class='card' style='width: 22%; margin: 1%; padding: 3px;'>"
                            +"<img class='card-img-top' src='http://localhost:3000/upload/"+val.productFileName+"' alt='Card image cap' width='110px' height='150px' style='object-fit: cover;'>"
                            +"<div class='card-img-top'>"
                            +"<h5 class='card-title'>"+val.productName+"</h5>"                            
                            +"<button class='btn btn-primary' onclick='addProduct("+val.productSeq+")'>product add</button>"
                            +"</div>"
                            +"</div>";                        
                    })
                    $("#_productListUp").append(app);
                }                
            },
            error:function(){
                alert("검색에러");
            }
        })        
    }

    // 이벤트 작성 완료
    function completeEvent(){
        var form = $('#eventForm').serialize();

         $.ajax({
            url:"http://localhost:3000/eventWrite",
            type:'post',           
            data:new FormData($('#eventForm')[0]),
            enctype:"multipart/form-data",
			processData:false,
			contentType:false,
			cache:false,
            success:function(str){
                if(str=="suc"){
                    location.href='event.html';
                }else{
                    alert("이벤트 등록실패");
                }
            },error:function(){
                alert("error");
            }

        }) 
       
    }

    function addCancel(){
        $("#_addProduct").remove();
        isDisabled = false;
    }
    
    
    // 중복 등록을 막기위함
    let isDisabled = false;

    // Product add 버튼 클릭시 추가 된 상품 표시
    function addProduct(seq){
        let app="";

        if(isDisabled){
            alert("상품은 1개만 등록 가능합니다");
            return false;
        }else{
            isDisabled = true; 
            $.ajax({
                url:"http://localhost:3000/getProductDetail",
                type:'post',
                data:{productSeq:seq},
                success:function(dto){   
                    app="<div class='input-group mb-3' style='width: 50%;' id='_addProduct'>"
                        +"<input type='text' class='form-control' readonly value='"+dto.productName+"'>"
                        +"<div class='input-group-append'>"
                        +"<button class='btn btn-outline-secondary' type='button' onclick='addCancel()'><i class='fa fa-times' aria-hidden='true'></i></button>"
                        +"</div>"                        
                        +"</div>"; 
                    // form을 걸었을때 의도치 않은 오류로 시퀀스를 다른곳에 숨겼음                    
                    proSeq = "<input type='hidden' name='productSeq' value='"+dto.productSeq+"'>" ;
                    $("#hideSeq").append(proSeq);      
                    $("#productNameInput").after(app);

                },error:function(){
                    alert("에러");
                }
            })
        }
    }


    $(document).ready(function() {

    $("#productNameInput").hide();


    // 이벤 내용 서머노트
    $('#eventFile').summernote({
          height: 300,                 // 에디터 높이
          minHeight: 150,             // 최소 높이
          maxHeight: null,             // 최대 높이
          focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
          lang: "ko-KR",					// 한글 설정
          placeholder: '이벤트 내용 사진 첨부(사진만 가능)',	//placeholder 설정
          toolbar: [   
          //툴바설정
			    // [groupName, [list of button]]
			    ['style', ['bold', 'italic', 'underline','strikethrough']],
			    ['insert',['picture']],
			    ['view', [ 'help']]
			    ],        
	});

    

    // 라디오 버튼 '예' 클릭 시 상품 검색창을 띄움
    $("input:radio[name='optradio']").click(function(){
        var temp = $('input:radio[name="optradio"]:checked').val();
        if(temp=="yes"){
            $("#productNameInput").show();

        }else{
            $("#productNameInput").hide();
            $("#_productListUp").empty();
            $("#productName").val("");            
            $("#_addProduct").hide();
            isDisabled = false;
        }
    })



});
    
</script>

</body>

</html>