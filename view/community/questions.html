<html>

<head>
    <meta charset="UTF-8">
    <title>ì™„ë²½í•œ ìì·¨ìƒí™œ, ì™„ì</title>
    <link rel="shortcut icon" href="../../assets/img/wanza-Icon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"> <!-- jQuery UI css -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" type="text/css" href="../../css/question.css">
    <link rel="stylesheet" type="text/css" href="../../css/question-detail.css">
    <link rel="stylesheet" type="text/css" href="../../css/question-comment.css">
    <link rel="stylesheet" type="text/css" href="../../css/style.css">

    <style>
    .questions-item-link:hover {
      text-decoration: none;
      
    }
    .questions-item-link:hover .questions-block{
      text-decoration: underline black;
    }

    .button {
      border: none;
      color: white;
      padding: 16px 32px;

      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      transition-duration: 0.4s;
      cursor: pointer;
      border-radius: 15px;
    }

    .question-btn1 {
      background-color: white; 
      color: black; 
      border: 2px solid coral;
    }

    .question-btn1:hover {
      background-color: coral;
      color: white;
    }

    .question-btn2 {
      background-color: white; 
      color: black; 
      border: 2px solid powderblue;
    }

    .question-btn2:hover {
      background-color: powderblue;
      color: white;
    }

    .w3-button{
      border-radius: 15px;

      
    }

   

    .w3-dropdown-click{
      background-color: coral;
      border-radius: 15px;
      color: white;
    }

    #body,#body p, #body b,#body h1, #body h2, #body h3, #body h5,#body h6, #body li{
      font-family: 'Nanum Gothic', sans-serif;
      font-weight: 500;
        /* font-weight: bold; */
    }

    .questions-item{
    color: black; 
    width: 800px; 
    margin: auto;
    padding-top: 20px;
    padding-bottom: 20px;
  }
  .questions-head-img{
    float: right;
  }
  .questions-head-image{
    width: 120px; 
    height: 120px; 
    border-radius: 30%;
    margin-left: 10px;
  }
  .questions-head{
    text-align: center;
  }
  .questions-title{
    color: black; 
    line-height: inherit;
  }
  .questions-content, .questions-content p{
    color: #636363;
    text-align: start; 
    font-size: 15px;
  }
  .questions-item-footer{
    font-size: 15;
  }
  .questions-item-footer-writer{
    color: coral;
  }
  .questions-item-footer-writer-image{
    width: 22px; 
    height: 22px; 
    border-radius: 70%;
    margin-right: 10px;
  }
  .questions-item-footer-tags{
    float: right;
  }
  .keyword-item{
    margin-top: 3px; 
    margin-bottom: 10px;
    padding-left: 10px; 
    padding-right: 10px;
  }

  .questions-item-footer-comments-content.active {
    font-weight: bold;
    color: coral
  }

  /* í˜ì´ì§• */
  .questions_page{
      min-height: 100px;
      margin: 30px 0;
  }
  #questions_items .pagination{
      justify-content: center;
  }
  #questions_items .page-item.active .page-link{
      background-color: coral;
      border-color: coral;
      color: white;
  }
  #questions_items a{
      color: #424242;
  }
  #questions_items .page-link:focus{
      box-shadow: none;
  }

    

    
    </style>


</head>




<body id="body" style="font-family: 'Nanum Gothic', sans-serif;">
    <header include-html="../commons/header.html"></header>
    <nav include-html="../commons/menuComm.html"></nav>

    <div id="questions-index-page" style="font-family: 'Noto Sans KR', sans-serif">
        <div id="questions-header">

          <div class="container">
            <div class="questions-header-title">
              <h1 class="text-heading-1 text-black bold">
                ì§ˆë¬¸ê³¼ ë‹µë³€
              </h1>
              <p class="text-caption-1">
                ì™„ìì˜ ì „ë¬¸ê°€ë“¤ì—ê²Œ ì§ˆë¬¸í•˜ê³  ì¡°ì–¸ì„ ë°›ì•„ë³´ì„¸ìš”.
              </p>
            </div>

            <!-- <form id="questions-headerform" class="sticky-top" action="/questions" accept-charset="UTF-8" method="get"> -->
              <!-- <input name="utf8" type="hidden" value="&#x2713;" /> -->
                  <div class="sticky-content">
                    <div class="questions-header-form-wrap row">
                      <div class="questions-header-form-search col">
                        <span class="icon icon-etc-find-sm-gray-dark search" aria-hidden="true">
                          <img src="../image/dbg.png" style="width: 22px; height: 22px; margin-left: 5px;">
                        </span>
                        <input type="text" name="query" id="questions-header-form-search" value="" class="form-control" placeholder="ê¶ê¸ˆí•œ ê²ƒì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”." autocomplete="off" style="color: coral;"/>
                      </div>
                    </div>
                  </div>
            <!-- </form> -->

          </div>
        </div>

        <div id = 'questions-filter' class="container" style="margin-top: 30px;margin-bottom: 30px;padding-left: 55px; font-family: 'Noto Sans KR', sans-serif">

          <div class="w3-dropdown-click">
            <button onclick="filterfunc()" class="w3-button" 
            style="padding-top: 16px; padding-right: 32px; padding-left: 32px; padding-bottom: 16px;">ì •ë ¬</button>
            <div id="Demo" class="w3-dropdown-content w3-bar-block w3-card-4 w3-animate-zoom">
              <button type="button" class="w3-bar-item w3-button" value="0">ìµœì‹ ìˆœ</button>
              <button type="button" class="w3-bar-item w3-button" value="1">ì¡°íšŒìˆœ</button>
              <button type="button" class="w3-bar-item w3-button" value="2">ìµœê·¼ ë‹µë³€ìˆœ</button>
              <input type="hidden" class="sortNum" value="0">
            </div>
          </div>

          <button class="button question-btn1" onclick="questionwrite()" style="float:right ;">ì§ˆë¬¸í•˜ê¸°</button>

          <button class="button question-btn2" onclick="questionanswer()" style="float: right;">ë‹µë³€ì„ ê¸°ë‹¤ë¦¬ëŠ” ì§ˆë¬¸</button>

        </div>

        
        <div id="questions-notice-list" class="container" style="margin-top: 30px;margin-bottom: 30px; font-family: 'Noto Sans KR', sans-serif">
          <ul class="questions-notice-list" style="margin:-5px 0; list-style: none; ">
              <li class="questions-notice-list-list" style="margin: 5px 0; padding:  10px 20px 10px 54px; background-color: #ffcb9d; border-radius: 10px; font-size: larger;">
                <a href="questionDetail.html?seq=0" style="color: black;">
                  <span ><img src="../image/wanza.png" style="width: 30px; height: 30px; margin-right: 15px;"></span>
                  <span class="title ">ì™„ìì˜ ì¸í…Œë¦¬ì–´ ë©˜í† ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”ğŸ†</span>
                </a>        
              </li>
              <li class="questions-notice-list-list" style="margin: 5px 0; padding:  10px 20px 10px 54px; background-color: #ffcb9d; border-radius: 10px; font-size: larger;">
                <a href="questionDetail.html?seq=1" style="color: black;">
                  <span ><img src="../image/wanza.png" style="width: 30px; height: 30px; margin-right: 15px;"></span>
                  <span class="title text-body-1">ë‹µë³€ ì´ë²¤íŠ¸ ì•ˆë‚´ ë° í™œë™ ì£¼ì˜ì‚¬í•­ ğŸ“¢</span>
                </a>        
              </li>
              <li class="questions-notice-list-list" style="margin: 5px 0; padding:  10px 20px 10px 54px; background-color: #ffcb9d; border-radius: 10px; font-size: larger;">
                <a href="questionDetail.html?seq=2" style="color: black;">
                  <span ><img src="../image/wanza.png" style="width: 30px; height: 30px; margin-right: 15px;"></span>
                  <span class="title text-body-1">ë¹ ë¥´ê³  ì •í™•í•œ ì¸í…Œë¦¬ì–´ ë‹µë³€ì„ ë°›ëŠ” ë°©ë²•ì€?</span>
                </a>        
              </li>
          </ul>
        </div>      

      <div class="questions-list-container mb-5" id="questions-list-container" >
         <!-- ì§ˆë¬¸ ë‹µë³€ ê²Œì‹œê¸€ ë¿Œë ¤ì§€ëŠ” ê³³ -->
      </div>

      <div class="questions_page" id="questions_items">
        <!-- ë°°ì†¡í˜„í™© í˜ì´ì§€ ë²ˆí˜¸ -->
    </div>

    </div>

    <link rel="stylesheet" href="../../assets/bootstrap/css/bootstrap.min.css">
    <footer include-html="../commons/footer.html"></footer>

</body>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/bootstrap/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script><!-- jQuery UI ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="../../js/jquery.twbsPagination.min.js"></script>
<script src="../../js/includeHTML.js"></script>
<script src="../../js/header.js"></script>
<script src="../../js/slang.js"></script>

<script>
$(document).ready(function(){
  getQuestionCount('',0,0)
  
  //ë¡œê·¸ì¸í•œ ê³„ì • ë‹‰ë„¤ì„ ê°€ì ¸ì˜¤ê¸°
  let sessionId = JSON.parse(sessionStorage.getItem("login"));
  console.log(sessionId);

  let urlParams = location.search.split(/[?&]/).slice(1).map(function(paramPair) {
            return paramPair.split(/=(.+)?/).slice(0, 2);
        }).reduce(function(obj, pairArray) {
            obj[pairArray[0]] = pairArray[1];
            return obj;
        }, {});
  
  let seq = urlParams.seq;	// html ì—ì„œ html ì´ë™í• ë•Œ ê°’ ê°€ì ¸ê°€ëŠ” ê·¸ëŸ° ì½”ë“œ
  //ê²€ìƒ‰ì–´ íŒŒë¼ë¯¸í„°ë¡œ ë°›ê¸°
  
  let searchWord = decodeURIComponent(urlParams.searchWord)
  if(searchWord!=null && searchWord!="undefined"){
    $('#questions-header-form-search').val(searchWord);
    getQuestionCount(searchWord,0,0)
  }

  //ê²€ìƒ‰
  $('#questions-header-form-search').on('propertychange change keyup paste input', function(k){
    if(k.keyCode == 13) {
      let word = $(this).val().trim()
      console.log(word)
      getQuestionCount(word,0,0)
    }
  });

  //ì •ë ¬
  $('.w3-bar-item').on('click', function(){
    let s = $(this).val()
    $('.sortNum').val(s)
    let word = $('#questions-header-form-search').val().trim()
    getQuestionCount(word,s,0)
  });

});

//ë‹µë³€ì„ ê¸°ë‹¤ë¦¬ëŠ” ì§ˆë¬¸
function questionanswer(){
  let sessionId = sessionStorage.getItem("login");
    if(sessionId == null || sessionId == '') {
        alert('ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”');
        location.href="../login/login.html";
    }
    else {
      $('.sortNum').val(3)
      let word = $('#questions-header-form-search').val().trim()
      getQuestionCount(word,3,0)
    }
}

// ì‘ì„± ì‹œê°„ ë‚˜íƒ€ë‚´ê¸°
function timeForToday(value) {
    const today = new Date();
    const timeValue = new Date(value);
    const betweenTime = Math.floor((today.getTime() - timeValue.getTime()) / 1000 / 60);
    if (betweenTime < 1) return 'ë°©ê¸ˆ ì „';
    if (betweenTime < 60) {
        return `${betweenTime}ë¶„ ì „`;
    }

    const betweenTimeHour = Math.floor(betweenTime / 60);
    if (betweenTimeHour < 24) {
        return `${betweenTimeHour}ì‹œê°„ ì „`;
    }

    const betweenTimeDay = Math.floor(betweenTime / 60 / 24);
    if (betweenTimeDay < 365) {
        return `${betweenTimeDay}ì¼ ì „`;
    }

    return `${Math.floor(betweenTimeDay / 365)}ë…„ ì „`;
}

// ë„˜ì–´ì˜¨ ê°’ì´ ë¹ˆê°’ì¸ì§€ ì²´í¬í•©ë‹ˆë‹¤. 
    // !value í•˜ë©´ ìƒê¸°ëŠ” ë…¼ë¦¬ì  ì˜¤ë¥˜ë¥¼ ì œê±°í•˜ê¸° ìœ„í•´ 
    // ëª…ì‹œì ìœ¼ë¡œ value == ì‚¬ìš© 
    // [], {} ë„ ë¹ˆê°’ìœ¼ë¡œ ì²˜ë¦¬ 
    var isEmpty = function(value){ 
    if( value == "" || value == null || value == undefined || ( value != null && typeof value == "object" && !Object.keys(value).length ) ){
        return true
        } else { 
        return false 
        } 
    }

  
//ì •ë ¬ë²„íŠ¼ ì„¤ì •ë¶€ë¶„
function filterfunc() {
  var x = document.getElementById("Demo");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
  } else { 
    x.className = x.className.replace(" w3-show", "");
  }
}

  //ì§ˆë¬¸í•˜ëŸ¬ ê°€ê¸°
  function questionwrite(){
    var logg = sessionStorage.getItem("login");

    if(logg == null) {
        alert('ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”');
        location.href="../login/login.html";
    }else{
      location.href = "questionWrite.html";
    }
    
  }

function getQuestionList(word,s,page){
    $.ajax({
      url:"http://localhost:3000/getQuestionList",
      type: "post",
      data: {searchWord:word, sort:s, startPage:page},
      success:function(list){
        console.log(list)
        $("#questions-list-container").html('');
        if( Object.keys(list).length==0 ){
          let app = '<div class="questions-item" style="height: 300px;">'
                  + '<div class="questions-block" style="height: 100%; text-align: center;">'
                  + '<h3 style="line-height: 250px;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</h3>'
                  + '</div></div>'
                  + '<div class="questions-item" style="height: 300px;"></div>'
          $("#questions-list-container").html(app);
        }else{
          $.each(list, function(i, val){
            
            let pfname = val.profileName;
            if(isEmpty(pfname) == false ){
              pfname = '../image/avatar.png';
            }
            let qfname = val.questionFileName;

            if(isEmpty(qfname) == true){
              qfname = 'wanza.png';
            }
            
            let unname = val.nickName;
            if(unname == 0 || unname == null){
              unname == 'ì•Œìˆ˜ì—†ëŠ” íšŒì›ì…ë‹ˆë‹¤.';
            }

            let app = "<div class='questions-item' >"
                      + "<a class='questions-item-link' href="
                      + "'questionDetail.html?seq="
                      + val.questionSeq
                      + "'>"
                      + "<div class='questions-block'>"
                      + "<div class='questions-head-img'>"
                      + "<img class='questions-head-image' src='http://localhost:3000/upload/"+qfname+"' >" 
                      + "</div>"
                      + "<div class='questions-head'>"
                      + "<h2 class='questions-title'>"
                      + val.questionTitle
                      + "</h2>"
                      + "<span class='questions-content'>"
                      + decodeHtmlEntity(val.questionContent)
                      + "</span>"       
                      + "</div>"
                      + "</a>"
                      + "<footer class='questions-item-footer'>"
                        + "<span class='questions-item-footer-author'>"  
                          + "<span class='questions-item-footer-writer-img'>"
                          + "<img class='questions-item-footer-writer-image'"
                          + "src='"
                          + pfname
                          + "'>"
                          + "</span>"
                          + "<span class='questions-item-footer-writer'>" + unname + "</span>"
                        + "</span>  &nbsp;&nbsp;&nbsp;&nbsp; "
                        + "<span class='questions-item-footer-meta'>"
                          + "<time class='questions-item-footer-date text-gray'>"
                          + timeForToday(val.questionRegDate)
                          + "</time>"
                          + "<span class='questions-item-footer-comments text-gray'>"
                          + "ëŒ“ê¸€&nbsp;"  
                            + "<span class='questions-item-footer-comments-content active'>"
                            + val.comentCount
                            + "</span>"
                          + "</span>"
                          + "<span class='questions-item-footer-views text-gray'>"
                            + "ì¡°íšŒ&nbsp;"
                            + "<span class='questions-item-footer-views-content'>"
                            + val.questionReadcount
                            + "</span>"
                          + "</span>"
                        + "</span>"
/*
                        + "<ul class='questions-item-footer-tags keyword-list'>"
                        + "<li class='keyword-item questions-item-footer-tags-tag'>"
                        + "ì…€í”„ì¸í…Œë¦¬ì–´"
                        + "</li>"
                        + "<li class='keyword-item questions-item-footer-tags-tag'>"
                        + "ì¡´ë§"
                        + "</li>"
                        + "</ul>"
*/
                      + "</footer>"
                      + "</div>"

                      

                      $("#questions-list-container").append(app);
            });
          }
      },
      error:function(list){ console.log('getQuestionList ì—ëŸ¬')  }
    });
}

//ê¸€ì˜ ì´ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜
function getQuestionCount(word,s,page) {
	$.ajax({
		url:"http://localhost:3000/getQuestionCount",
		type:"get",
		data:{searchWord:word, sort:s, startPage:page},
		success:function(count){ loadPage(count); },
		error:function(){ console.log('error'); }
	});
}

//í˜ì´ì§€ ì²˜ë¦¬ë¥¼ í•˜ëŠ” í•¨ìˆ˜
function loadPage(totalCount) {
	let pageSize = 5;
	let nowPage = 1;

	let _totalPages = totalCount / pageSize;
	console.log("í˜ì´ì§€ìˆ˜:"+_totalPages);
	
	if(totalCount%pageSize > 0){
		_totalPages = Math.ceil(_totalPages);
		//_totalPages++;
	}
	//$(".questions_page").twbsPagination("destroy"); //ì´ˆê¸°í™”
	$(".questions_page").twbsPagination({
		startPage: 1,
		totalPages: _totalPages,
		visiblePages:10, //í˜ì´ì§€ë²ˆí˜¸ë¥¼ ëª‡ê°œê¹Œì§€ ë³´ì¼ê±´ê°€
		first:'<span sria-hidden="true">Â«</span>',
		prev:"ì´ì „",
		next:"ë‹¤ìŒ",
		last:'<span sria-hidden="true">Â»</span>',
		initiateStartPageClick:false, //ì˜¨ í˜ì´ì§€ í´ë¦­ì´ ìë™ì‹¤í–‰ì—¬ë¶€ ê²°ì •
		onPageClick:function(event,page){
			nowPage = page;
      let word = $('#questions-header-form-search').val().trim();
      let sortNum = $('.sortNum').val();
      getQuestionList(word,sortNum,page-1);
		}
	});
    if(_totalPages>0){
        $(".questions_page").twbsPagination("changeTotalPages",_totalPages,nowPage);
    }else{
        $(".questions_page").twbsPagination("changeTotalPages",1,1);
    }
}

//ì—”í‹°í‹°ì½”ë“œ ë‹¤ì‹œ ëŒë ¤ë†“ê¸°
function decodeHtmlEntity(str){ 
  let textarea = document.createElement("textarea");  
  textarea.innerHTML = str;
  let result = textarea.value;
  textarea.remove();
  //textarea.parentNode.removeChild(textarea); 
  return result;
}
</script>


</html>