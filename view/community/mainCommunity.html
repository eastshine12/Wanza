<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>완벽한 자취생활, 완자</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="shortcut icon" href="../../assets/img/wanza-Icon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../css/style.css">

    <style>
        
        .del_icon {
            color: rgb(255, 92, 92);
            display: flex;
            justify-content:flex-end;
            margin-right:30px; 
            
        }
        .fa.fa-minus-circle.fa-lg{
            cursor: pointer;
        }
        .fa.fa-minus-circle.fa-lg:hover {
            color: rgb(255, 173, 173);
        }

        .ribbon-wrapper {
            position: absolute;
            top: 0px; right: 20px;
            display: flex;
            width: 30px; height: 50px;
            justify-content: center;
            overflow: hidden;
        }
        .ribbon {
            position: relative;
            width: 30px; height: 30px;
            padding: 6px 0 0 0;
            background-color: rgb(244,116,76);
            color: #fff;
            font: bold 16px sans-serif;
            text-align: center;
            z-index: 10;
        }
        .ribbon::before {
            content: "";
            position: absolute;
            background: rgb(244,116,76);
            width: 20px; height: 20px;
            left: -10px;
            bottom: -10px;
            transform: rotate(45deg);
        }
        .ribbon::after {
            content: "";
            position: absolute;
            background: rgb(244,116,76);
            width: 20px; height: 20px;
            right: -10px;
            bottom: -10px;
            transform: rotate(45deg);
        }
        
        .carousel-caption .btn {
            opacity: 0.6;
            color: rgb(255,255,255);
            margin-left: 0px;
            width: 135px;
            height: 55px;
            border-width: 2px;
            background-color: rgba(211, 174, 164, 0.452);
            border-color: rgb(244,116,76);
            text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);
        }

        .carousel-caption .btn:hover {
            opacity: 1;
            transform:scale(1.02);
            color: rgb(255,255,255);
            margin-left: 0px;
            width: 135px;
            height: 55px;
            border-width: 2px;
            background-color: rgba(235, 155, 137, 0.363);
            border-color: rgb(245, 98, 53);
            text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);
        }
        
    </style>
</head>

<body>
    <header include-html="../commons/header.html"></header>
    <nav include-html="../commons/menuComm.html"></nav>
    <div class="container" style="height: 600px;width: 1200px;margin-top: 50px;">
        <div class="row">
            <div class="col-md-8">

                <!-- 왼쪽 캐러셀 -->
                <div class="carousel slide" data-ride="carousel" id="carousel-1" style="border-radius: 0px;width: 100%;">
                    <div class="carousel-inner" style="border-radius: 20px;">

                        <div class="carousel-item active"><img id="carousel_rank1_img" class="w-100 d-block" src="../../assets/img/KakaoTalk_20210506_154158464.jpg" 
                            alt="Slide Image" style="height: 500px;object-fit: cover;">
                        <div class="carousel-caption"
                            style="font-family: 'Noto Sans KR', sans-serif;margin-bottom: 0px;text-align: left;height: 450px; padding-top: 5px;">
                            <p style="font-size: 18px; margin-bottom: 7px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);">인기 인테리어 1위</p>
                            <h1 style="font-size: 36px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);">
                                <strong id="carousel_rank1_title"><!-- 제목 --></strong></h1>
                            <p style="font-size: 18px;margin-right: 148px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);"><span id="carousel_rank1_nickname"><!-- 닉네임 --></span> 님의 인테리어 사진</p>
                        </div>
                        <div class="carousel-caption"
                            style="font-family: 'Noto Sans KR', sans-serif;text-align: right;padding-left: 0px;padding-right: 0px;margin-left: 0px;width: 568px;">
                            <button id="carousel_rank1_btn" class="btn btn-lg" type="button">보러가기</button>
                        </div>
                    </div>

                        <div class="carousel-item"><img id="carousel_rank2_img" class="w-100 d-block" src="../../assets/img/KakaoTalk_20210506_154158464.jpg" 
                                alt="Slide Image" style="height: 500px;object-fit: cover;">
                            <div class="carousel-caption"
                                style="font-family: 'Noto Sans KR', sans-serif;margin-bottom: 0px;text-align: left;height: 450px; padding-top: 5px;">
                                <p style="font-size: 18px; margin-bottom: 7px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);">인기 인테리어 2위</p>
                                <h1 style="font-size: 36px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);">
                                    <strong id="carousel_rank2_title"><!-- 제목 --></strong></h1>
                                <p style="font-size: 18px;margin-right: 148px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);"><span id="carousel_rank2_nickname"><!-- 닉네임 --></span> 님의 인테리어 사진</p>
                            </div>
                            <div class="carousel-caption"
                                style="font-family: 'Noto Sans KR', sans-serif;text-align: right;padding-left: 0px;padding-right: 0px;margin-left: 0px;width: 568px;">
                                <button id="carousel_rank2_btn" class="btn btn-lg" type="button">보러가기</button>
                            </div>
                        </div>
                        
                        <div class="carousel-item"><img id="carousel_rank3_img" class="w-100 d-block" src="../../assets/img/KakaoTalk_20210506_154158464.jpg" 
                            alt="Slide Image" style="height: 500px;object-fit: cover;">
                        <div class="carousel-caption"
                            style="font-family: 'Noto Sans KR', sans-serif;margin-bottom: 0px;text-align: left; height: 450px; padding-top: 5px;">
                            <p style="font-size: 18px; margin-bottom: 7px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);">인기 인테리어 3위</p>
                            <h1 style="font-size: 36px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);">
                                <strong id="carousel_rank3_title"><!-- 제목 --></strong></h1>
                            <p style="font-size: 18px;margin-right: 148px;text-shadow: 1px 2px 2px rgba(88, 88, 88, 0.445);"><span id="carousel_rank3_nickname"><!-- 닉네임 --></span> 님의 인테리어 사진</p>
                        </div>
                        <div class="carousel-caption"
                            style="font-family: 'Noto Sans KR', sans-serif;text-align: right;padding-left: 0px;padding-right: 0px;margin-left: 0px;width: 568px;">
                            <button id="carousel_rank3_btn" class="btn btn-lg" type="button">보러가기</button>
                        </div>
                    </div>

                    </div>
                    <div><a class="carousel-control-prev" href="#carousel-1" role="button" data-slide="prev"
                            style="width: 70px;"><span class="carousel-control-prev-icon"></span><span
                                class="sr-only">Previous</span></a><a class="carousel-control-next" href="#carousel-1"
                            role="button" data-slide="next" style="width: 70px;"><span
                                class="carousel-control-next-icon"></span><span class="sr-only">Next</span></a></div>
                    <ol class="carousel-indicators">
                        <li data-target="#carousel-1" data-slide-to="0" class="active"></li>
                        <li data-target="#carousel-1" data-slide-to="1"></li>
                        <li data-target="#carousel-1" data-slide-to="2"></li>
                    </ol>
                </div>
            </div>

            <!-- 오른쪽 캐러셀 -->
            <div class="col-md-4">
                <div class="carousel slide" data-ride="carousel" id="carousel-2">
                    <div class="carousel-inner" style="border-radius: 20px;">

                        <div class="carousel-item active"><img class="w-100 d-block"
                                src="../../assets/img/160706703783174685.webp" alt="Slide Image"
                                style="height: 500px;object-fit: cover;"></div>

                        <div class="carousel-item"><img class="w-100 d-block" src="../../assets/img/222.jpg" alt="Slide Image"
                                style="height: 500px;object-fit: cover;"></div>

                        <div class="carousel-item"><img class="w-100 d-block" src="../../assets/img/다운로드 (2).jfif" alt="Slide Image"
                                style="height: 500px;object-fit: cover;"></div>

                    </div>
                    <div><a class="carousel-control-prev" href="#carousel-2" role="button" data-slide="prev"><span
                                class="carousel-control-prev-icon"></span><span class="sr-only">Previous</span></a><a
                            class="carousel-control-next" href="#carousel-2" role="button" data-slide="next"><span
                                class="carousel-control-next-icon"></span><span class="sr-only">Next</span></a></div>
                    <ol class="carousel-indicators">
                        <li data-target="#carousel-2" data-slide-to="0" class="active"></li>
                        <li data-target="#carousel-2" data-slide-to="1"></li>
                        <li data-target="#carousel-2" data-slide-to="2"></li>
                    </ol>
                </div>
            </div>


        </div>
    </div>
    <div class="container" style="width: 1200px;height: 340px;">
        <div class="row">
            <div class="col">
                <h1 style="font-size: 30px;margin-bottom: 15px;"><strong>카테고리</strong></h1>
            </div>
        </div>
        <div class="row" style="margin-top: 15px;">
            <div class="col" style="text-align: center;">
                <figure class="figure" style="margin-right: 15px;margin-left: 15px; cursor: pointer;"><img class="img-fluid figure-img"
                        src="../../assets/img/가구.png" width="150px">
                    <figcaption class="figure-caption" style="text-align: center;font-size: 17px;"><strong>가구</strong>
                    </figcaption>
                </figure>
                <figure class="figure" style="margin-right: 15px;margin-left: 15px; cursor: pointer;"><img class="img-fluid figure-img"
                        src="../../assets/img/조명.png" width="150px">
                    <figcaption class="figure-caption" style="text-align: center;font-size: 17px;"><strong>조명</strong>
                    </figcaption>
                </figure>
                <figure class="figure" style="margin-right: 15px;margin-left: 15px; cursor: pointer;"><img class="img-fluid figure-img"
                        src="../../assets/img/데코.png" width="150px">
                    <figcaption class="figure-caption" style="text-align: center;font-size: 17px;"><strong>홈데코</strong>
                    </figcaption>
                </figure>
                <figure class="figure" style="margin-right: 15px;margin-left: 15px; cursor: pointer;"><img class="img-fluid figure-img"
                        src="../../assets/img/패브릭.png" width="150px">
                    <figcaption class="figure-caption" style="text-align: center;font-size: 17px;"><strong>패브릭</strong>
                    </figcaption>
                </figure>
                <figure class="figure" style="margin-right: 15px;margin-left: 15px; cursor: pointer;"><img class="img-fluid figure-img"
                        src="../../assets/img/수납.png" width="150px">
                    <figcaption class="figure-caption" style="text-align: center;font-size: 17px;"><strong>수납정리</strong>
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
    <div class="container" style="width: 1200px;">
        <h1 style="font-size: 30px;margin-bottom: 50px;"><strong>오늘의 인기상품</strong></h1>
        <div id="hotProductList" class="row">
        
            <!-- 인기 상품 리스트 생성되는 곳 -->

            <!-- <div style="width: 350px; height: 400px; margin: 3px;">
                <article article class="project2_wrap" >
                    <a href="../store/storeDetail.html?seq=1"></a>
                        <div class="project2_item">
                            <span></span><img src="http://192.168.0.231:3000/upload/" alt="">
                            
                            <div class="ribbon-wrapper">
                                <div class="ribbon">1</div>
                            </div>

                        </div>
                        <div class="row" style="margin:0px 40px; margin-top: 15px;margin-bottom: 10px;">
                            <h3 style="font-family: \'Noto Sans KR\'; font-size: 17px; height: 32px;float: none; margin:0 auto;">
                                val.productName
                            </h3>
                        </div>
                </article>
            </div> -->

        </div>
    </div>




    <div class="container" id="hotCard" style="width: 1200px;">
        <h1 style="font-size: 30px;margin-top: 30px; margin-bottom: 15px;"><strong>이번주 인기 인테리어 사진</strong></h1>
        <div style="margin-top: 50px;">
            <div id="hotCardList" class="row">

                <!-- 인기 인테리어 리스트 생성되는 곳 -->

            </div>



        </div>
    </div>
    
    
    




    <footer include-html="../commons/footer.html"></footer>

    <script src="../../assets/js/jquery.min.js"></script>
    <script src="../../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../js/includeHTML.js"></script>
    <script src="../../js/header.js"></script>
    <script src="../../js/slang.js"></script>
    
</body>


<script>

    //로그인한 계정 닉네임 가져오기
    let sessionId = JSON.parse(sessionStorage.getItem("login"));
    if(sessionId == null) {
        sessionId = '';
    };
    console.log(sessionId);

    //화면 인기글이동
    $(document).ready(function(){
        let page_url = window.location.href;
        let page_id = page_url.substring(page_url.lastIndexOf("l") + 1);

        $(document).ajaxComplete(function(){
            if(page_id=='#'){
                $('html, body').animate({ scrollTop: $("#hotCard").offset().top-70 }, 500);
            }
        })
    });

    $('#navcol-2 .nav_a').click(function(){//인기글 이동  
        if($(this).text()=='인기글'){
            let oset = $("#hotCard").offset();
            console.log(oset)
            $('html, body').animate({ scrollTop: $("#hotCard").offset().top-70 }, 500);
            return false;
        }
    });

    // 금액 콤마 삽입 정규식
    function makeComma(str) {
        str = String(str);
        return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
    };

    //할인 퍼센테이지 계산
    function discountRate(price, discount) {
        return Math.ceil(100- (discount/price*100));
    };

    // '인기 상품' 리스트
    getProductList();
    function getProductList() {
        $.ajax({
            url: "http://192.168.0.231:3000/getProductSortList", //getProductSortList getProductList
            type: "get",
            data:{recentPeriod:3,startNum:1,endNum:9},
            success: function (list) {
                console.log(list);
                let app = ""
                if (Object.keys(list).length == 0) {	// JSON형식의 길이
                    app += '<div style="width: 320px; margin-right: 50px;">'
                        + '<h3 style="font-size: 15px; margin-top: 10px;"><b>게시글이 없습니다.</b></h3>'
                        + "</div>";
                    $("#hotProductList").append(app);
                } else {
                    $.each(list, function (i, val) {
                        app += '<div style="width: 350px; height: 400px; margin: 3px;">'
                            +  '<article article class="project2_wrap" >';

                        if(sessionId != '' && sessionId.auth == 3) {
                            app += '<div class="del_icon"><i name="delete_product_btn" seq="'+val.productSeq+'" class="fa fa-minus-circle fa-lg" aria-hidden="true"></i></div>'
                        };

                        app +=  '<a href="../store/storeDetail.html?seq=' + val.productSeq + '"></a>'
                            +  '<div class="project2_item">'
                            +  '<span></span>'
                            +  '<img src="http://192.168.0.231:3000/upload/' + val.productFileName + '" alt="">';

                        if(i==0) {
                            app += '<div class="ribbon-wrapper"><div class="ribbon">1</div></div>'
                        } else if(i==1) {
                            app += '<div class="ribbon-wrapper"><div class="ribbon">2</div></div>'
                        } else if(i==2) {
                            app += '<div class="ribbon-wrapper"><div class="ribbon">3</div></div>'
                        }

                        app +=  '</div>'
                            +  '<div class="row" style="margin:0px 40px; margin-top: 15px;margin-bottom: 10px;"><h3 style="font-family: \'Noto Sans KR\'; font-size: 17px; height: 32px;float: none; margin:0 auto;">';
                            
                            if(val.productName.length > 48) {
                                app += val.productName.substr(0,48)+'...';
                            } else {
                                app += val.productName;
                            }     
                            
                        app += '</h3></div><div class="row">';
                        if(val.productDiscount != 0) {
                            app += '<p style="float: none; margin:0 auto;"><span style="font-family: \'Noto Sans KR\';font-size: 15px; color:gray;"><del>'+makeComma(val.productPrice)+'원</del>&nbsp;&nbsp;</span><span style="font-family: \'Noto Sans KR\';font-size: 17px;"><b>' + makeComma(val.productDiscount) + ' 원</b>&nbsp;&nbsp;</span>'
                                + '<span style="font-family: \'Noto Sans KR\';font-size: 17px;color:rgb(244,116,76)"><b>'+discountRate(val.productPrice, val.productDiscount) + '%</b></span></p>';
                        } else {
                            app += '<p style="float: none; margin:0 auto;"><span style="font-family: \'Noto Sans KR\';font-size: 17px;"><b>' + makeComma(val.productPrice) + ' 원</b></span></p>';
                        }

                        app += '</div><div style="font-family: \'Noto Sans KR\'; font-size: 14px;margin-top: 7px;"><i class="fa fa-star" style="font-size: 17px;color: rgb(244,116,76);margin-left: 2px;"></i> ' + val.productRating + '&ensp;│&ensp;<b>리뷰 </b>' + val.reviewCount + '</div>'
                            +  '</article>'
                            +  '</div >';
                    });
                    $("#hotProductList").append(app);
                }
            },
            error: function () { console.log('error'); }
        });
    };
    
    // '인기 인테리어 사진' 리스트
    getCardList();
    function getCardList() {
        $.ajax({
            url: "http://192.168.0.231:3000/getCardSortList",
            type: "get",
            data: {sort:3,cardDel:12},
            success: function (list) {
                console.log(list);
                let app = ""
                if (Object.keys(list).length == 0) {	// JSON형식의 길이
                    app += '<div style="width: 320px; margin-right: 50px;">'
                        + '<h3 style="font-size: 15px; margin-top: 10px;"><b>게시글이 없습니다.</b></h3>'
                        + "</div>";
                    $("#hotCardList").append(app);
                } else {
                    $.each(list, function (i, val) {

                        if(i == 0) {
                            $('#carousel_rank1_title').text(val.cardTitle);
                            $('#carousel_rank1_nickname').text(val.nickName);
                            $('#carousel_rank1_img').attr('src', 'http://192.168.0.231:3000/upload/'+val.cardFileName);
                            $('#carousel_rank1_btn').attr('onclick', 'location.href = "/view/community/storyDetail.html?seq='+val.cardSeq+'"');
                        } else if(i == 1) {
                            $('#carousel_rank2_title').text(val.cardTitle);
                            $('#carousel_rank2_nickname').text(val.nickName);
                            $('#carousel_rank2_img').attr('src', 'http://192.168.0.231:3000/upload/'+val.cardFileName);
                            $('#carousel_rank2_btn').attr('onclick', 'location.href = "/view/community/storyDetail.html?seq='+val.cardSeq+'"');
                        } else if(i == 2) {
                            $('#carousel_rank3_title').text(val.cardTitle);
                            $('#carousel_rank3_nickname').text(val.nickName);
                            $('#carousel_rank3_img').attr('src', 'http://192.168.0.231:3000/upload/'+val.cardFileName);
                            $('#carousel_rank3_btn').attr('onclick', 'location.href = "/view/community/storyDetail.html?seq='+val.cardSeq+'"');
                        };

                        app += '<div style="width: 320px; margin-right: 50px;">'
                            +   '<article article class="project_wrap" >'
                            +    '<a href="./storyDetail.html?seq='+val.cardSeq+'"></a>'
                            +     '<div class="project_item">'
                            +      '<span></span>'
                            +      '<img src="http://192.168.0.231:3000/upload/'+val.cardFileName+'" alt="">'
                            +     '</div>'
                            +     '<h3 style="font-family: \'Noto Sans KR\'; font-size: 16px; margin-top: 15px; height: 32px;"><b>'+val.cardTitle+'</b></h3>'
                            +     '<span style="font-family: \'Noto Sans KR\';font-size: 13px;"><b>'+val.nickName+'</b></span>'
                            +    '<div style="font-family: \'Noto Sans KR\'; font-size: 13px;margin-top: 5px;"><i class="fa fa-heart" style="font-size: 13px;color: rgb(244,116,76);margin-left: 2px;"></i> '+val.likeCount+'&ensp;│&ensp;<b>조회</b> '+val.cardReadCount+'</div>'
                            +   '</article>'
                            +  '</div >'

                    });
                    $("#hotCardList").append(app);
                }
            },
            error: function () {  console.log('error');  }
        });
    };


    //카테고리 이동
    $(document).on('click','.figure', function() {
        location.href = "../store/mainStore.html?category="+$(this).children().text();
    })

    
    // admin 상품 삭제 버튼
    $(document).on('click','i[name=delete_product_btn]' , function() {
        if(confirm("정말 삭제하시겠습니까?")==true) {
            let productSeq = $(this).attr('seq');

            $.ajax({
                url:"http://192.168.0.231:3000/deleteProduct",
                method: "get",
                data:{
                    productSeq: productSeq
                },
                success:function(data) {
                    if(data == "suc") {
                        alert('상품 삭제가 완료되었습니다.');
                    }
                },
                error:function(){
                    alert('error');
                },
                complete:function(){
                    location.reload();
                }
            });

        } else {
            return;
        }
    })


</script>

</html>