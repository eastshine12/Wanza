<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

  
<mapper namespace="com.decolab.wanza.dao.ProductDAO">

<!-- 메인 상품글 리스트 가져오기 -->
<select id="getProductList" resultType="com.decolab.wanza.dto.ProductDTO">
	SELECT PRODUCTSEQ, PRODUCTNAME, PRODUCTCONTENT, PRODUCTPRICE, PRODUCTDISCOUNT, PRODUCTMAKER, PRODUCTFILENAME, PRODUCTRATING
	FROM PRODUCTIONS
	ORDER BY PRODUCTSEQ DESC
</select>

<!-- 상품글 디테일 가져오기 -->
<select id="getProductDetail" parameterType="com.decolab.wanza.dto.ProductDTO" resultType="com.decolab.wanza.dto.ProductDTO">
	SELECT PRODUCTSEQ, PRODUCTNAME, PRODUCTCONTENT, PRODUCTPRICE, PRODUCTDISCOUNT, PRODUCTMAKER, PRODUCTFILENAME, PRODUCTRATING
	FROM PRODUCTIONS
	WHERE PRODUCTSEQ=#{productSeq}
</select>

<!-- 상품 검색 리스트 가져오기 -->
<select id="getSearchProduct" parameterType="com.decolab.wanza.dto.ProductDTO" resultType="com.decolab.wanza.dto.ProductDTO">
	SELECT PRODUCTSEQ, PRODUCTNAME, PRODUCTCONTENT, PRODUCTPRICE, PRODUCTDISCOUNT, PRODUCTMAKER, PRODUCTFILENAME, PRODUCTRATING
	FROM PRODUCTIONS
	WHERE PRODUCTNAME LIKE'%'||#{productName}||'%'
</select>

<!-- 상품글 리스트 분류하여 가져오기 -->
<select id="getProductSortList" parameterType="com.decolab.wanza.dto.ProductDTO" resultType="com.decolab.wanza.dto.ProductDTO">
	SELECT P.PRODUCTSEQ, PRODUCTNAME, PRODUCTCONTENT, PRODUCTPRICE, PRODUCTDISCOUNT, PRODUCTMAKER, PRODUCTFILENAME, PRODUCTRATING,
	       LARGECATEGORY, MEDIUMCATEGORY,SMALLCATEGORY,PURCHASECOUNT
	FROM PRODUCTIONS P, PRODUCTION_TAG T, (SELECT PRODUCTSEQ,
							<choose>
								<when test="sort neq 0">COUNT(*) PURCHASECOUNT</when>
								<otherwise>COUNT(CASE WHEN PURCHASEDATE > SYSDATE-30 THEN 0 END) PURCHASECOUNT</otherwise>
							</choose>
                                           FROM PURCHASE_PRODUCT
                                           GROUP BY PRODUCTSEQ) C
	WHERE P.PRODUCTSEQ=T.PRODUCTSEQ AND P.PRODUCTSEQ=C.PRODUCTSEQ(+)
	<if test='largeCategory neq null and largeCategory neq ""'>AND LARGECATEGORY=#{largeCategory}</if>
	<if test='mediumCategory neq null and mediumCategory neq ""'>AND MEDIUMCATEGORY=#{mediumCategory}</if>
	<if test='smallCategory neq null and smallCategory neq ""'>AND SMALLCATEGORY=#{smallCategory}</if>
	<choose>
		<when test="sort eq 1"> ORDER BY PRODUCTRATING DESC</when>
		<when test="sort eq 2"> ORDER BY PRODUCTDATE DESC</when>
		<when test="sort eq 3"> ORDER BY PURCHASECOUNT DESC</when>
		<otherwise> ORDER BY PRODUCTSEQ DESC</otherwise>
	</choose>
</select>
  
</mapper>