<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.decolab.wanza.dao.QuestionDAO">

	<!-- 질문과답변 전체 목록 가져오기 -->
	<select id="getAllQuestionList" resultType="com.decolab.wanza.dto.QuestionDTO">
		SELECT QUESTIONSEQ, QUESTIONTITLE, QUESTIONCONTENT, QUESTIONREADCOUNT, QUESTIONREGDATE, QUESTIONFILENAME, QUESTIONDEL 
		FROM QUESTION
		ORDER BY QUESTIONSEQ DESC
		<!-- ORDER BY QUESTIONSEQ DESC -->
	</select>
	
	<!-- 질문과답변 글쓰기 -->
	<insert id="questionWrite" parameterType="com.decolab.wanza.dto.QuestionDTO">
		INSERT INTO QUESTION
		VALUES(QUESTIONSEQ.NEXTVAL, #{userSeq}, #{questionTitle}, #{questionContent}, 0, SYSDATE, #{questionFileName}, 0, 0, 0, 0)
	</insert>
	
	<!-- 질문과답변 디테일가져오기 
	<select id="questionDetail" parameterType="com.decolab.wanza.dto.QuestionDTO" resultType="com.decolab.wanza.dto.QuestionDTO">
		SELECT QUESTIONSEQ, QUESTIONTITLE, QUESTIONCONTENT, QUESTIONREADCOUNT, QUESTIONREGDATE, QUESTIONFILENAME, QUESTIONDEL, QUESTIONREF, QUESTIONSTEP QUESTIONDEPTH
		FROM QUESTION
		WHERE QUESTIONSEQ = #{questionSeq}
	</select>-->
	
	<!-- 질문과답변 디테일가져오기 & 유저테이블정보도 다 가져오기 -->
	<select id="questionDetail" parameterType="com.decolab.wanza.dto.QuestionDTO" resultType="com.decolab.wanza.dto.QuestionDTO">
		SELECT Q.QUESTIONSEQ 
			,Q.USERSEQ 
			,Q.QUESTIONTITLE 
			,Q.QUESTIONCONTENT 
			,Q.QUESTIONREADCOUNT 
			,Q.QUESTIONREGDATE 
			,Q.QUESTIONFILENAME 
			,Q.QUESTIONDEL
		   	,U.USERNAME 
		   	,U.NICKNAME 
		   	,U.PROFILENAME 
		   	,U.AUTH
		FROM QUESTION Q, USERS U
		WHERE 1=1
		AND Q.USERSEQ = U.USERSEQ 
		AND Q.QUESTIONSEQ = #{questionSeq}
	</select>
	
	<!-- 질문과답변 댓글리스트 가져오기 -->
	<select id="questionCommentList" parameterType="com.decolab.wanza.dto.QuestionCommentDTO" resultType="com.decolab.wanza.dto.QuestionCommentDTO">
		SELECT Q.QUESTIONSEQ
		, Q.USERSEQ
		, Q.QCSEQ
		, Q.QCCONTENT
		, Q.QCREGDATE
		, Q.QCFILENAME
		, Q.QCDEL
		, Q.QCREF
		, Q.QCSTEP
		, Q.QCDEPTH
        , U.USERNAME
        , U.NICKNAME
        , U.AUTH
		FROM Q_COMMENT Q, USERS U
		WHERE 1=1 
		AND Q.USERSEQ = U.USERSEQ 
		AND Q.QUESTIONSEQ = #{questionSeq}
		<!-- ORDER BY Q_COMMENTSEQ DESC, Q_COMMENTREF ASC -->
		
	</select>
	
	<!-- 질문과답변 댓글쓰기 -->
	<insert id="questionComment" parameterType="com.decolab.wanza.dto.QuestionCommentDTO">
		INSERT INTO Q_COMMENT
		VALUES(#{questionSeq}, #{userSeq}, QCSEQ.NEXTVAL, #{qcContent}, SYSDATE, #{qcFileName}, 0, 0, 0, 0)
	</insert>
	
	
	<!-- 질문과답변 목록 가져오기 -->
	<!-- <select id="getQuestionList" resultType="com.decolab.wanza.dto.QuestionDTO">
		SELECT QUESTIONSEQ, QUESTIONTITLE, QUESTIONCONTENT, QUESTIONREADCOUNT, QUESTIONDATE, QUESTIONFILENAME, QUESTIONNEWFILENAME, QUESTIONDEL, 
		QUESTIONREF, QUESTIONSTEP, QUESTIONDEPTH 
		FROM (SELECT ROW_NUMBER()OVER(ORDER BY REF DESC, STEP ASC) AS RNUM,
			  QUESTIONSEQ, QUESTIONTITLE, QUESTIONCONTENT, QUESTIONDATE, QUESTIONDEL, QUESTIONREADCOUNT, QUESTIONREF, QUESTIONSTEP, QUESTIONDEPTH
			  FROM QUESTION
			  WHERE 1=1
			  <if test="choice != null and choice != ''
			  		and search != null and search != ''">
			  	  AND DEL=0		
				  <if test="choice == 'title'">
				  		AND TITLE LIKE '%'||#{search}||'%'		  
				  </if>
				  <if test="choice == 'content'">
				  		AND CONTENT LIKE '%'||#{search}||'%'			  
				  </if>
				  <if test="choice == 'writer'">
				  		AND ID=#{search}  
				  </if>	
			  </if>
			ORDER BY REF DESC, STEP ASC)
		WHERE RNUM BETWEEN ${start} AND ${end}
	</select> -->
	
	<!-- 질문과답변 총수 --> 
	<!-- <select id="getBbsCount" parameterType="bit.com.a.dto.BbsParam" resultType="java.lang.Integer">
		SELECT NVL(COUNT(*), 0)
		FROM BBS
		WHERE 1=1
		<if test="choice != null and choice != ''
		  		and search != null and search != ''">	  	  		
			  <if test="choice == 'title'">
			  		AND TITLE LIKE '%'||#{search}||'%'		  
			  </if>
			  <if test="choice == 'content'">
			  		AND CONTENT LIKE '%'||#{search}||'%'			  
			  </if>
			  <if test="choice == 'writer'">
			  		AND ID=#{search}  
			  </if>	
		  </if>
	</select> -->
	
	
</mapper>



  