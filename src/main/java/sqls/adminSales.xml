<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.decolab.wanza.dao.AdminSalesDAO">
<!-- 라인그래프 -->
<select id="graphList" parameterType="com.decolab.wanza.dto.admin.AdminSalesDTO" resultType="com.decolab.wanza.dto.admin.AdminSalesDTO">

SELECT SUM(PRODUCTAMOUNT) AS TOTAL,

<choose>
<when test="sType==1">
(TO_CHAR(ORDERDATE,'YYYY-MM-DD')) AS SDAY
</when>
<when test="sType==3">
(TO_CHAR(ORDERDATE,'YYYY-MM')) AS SDAY
</when>
<when test="sType==4">
(TO_CHAR(ORDERDATE,'YYYY')) AS SDAY
</when>
<otherwise>
(TO_CHAR(ORDERDATE,'YYYY-MM-DD')) AS SDAY
</otherwise>
</choose>
FROM ORDERS
WHERE ORDERDATE >= TO_DATE(#{sDate},'YYYY-MM-DD') AND TO_DATE(#{eDate},'YYYY-MM-DD')+1 >= ORDERDATE
<choose>
<when test="sType==1">
GROUP BY (TO_CHAR(ORDERDATE,'YYYY-MM-DD'))
ORDER BY (TO_CHAR(ORDERDATE,'YYYY-MM-DD'))
</when>
<when test="sType==3">
GROUP BY (TO_CHAR(ORDERDATE,'YYYY-MM'))
ORDER BY (TO_CHAR(ORDERDATE,'YYYY-MM'))
</when>
<when test="sType==4">
GROUP BY (TO_CHAR(ORDERDATE,'YYYY'))
ORDER BY (TO_CHAR(ORDERDATE,'YYYY'))
</when>
<otherwise>
GROUP BY (TO_CHAR(ORDERDATE,'YYYY-MM-DD'))
ORDER BY (TO_CHAR(ORDERDATE,'YYYY-MM-DD'))
</otherwise>
</choose>
</select>

<!-- 맵  -->
<select id="mapList" parameterType="com.decolab.wanza.dto.admin.AdminSalesDTO" resultType="com.decolab.wanza.dto.admin.AdminSalesDTO">
SELECT COUNTRY, COUNT(*)as count
FROM ORDERS O,(SELECT ADDRESSSEQ, SUBSTR(ADDRESS,0,INSTR(ADDRESS,' ')-1)COUNTRY 
                FROM ADDRESS)A
WHERE O.ADDRESSSEQ = A.ADDRESSSEQ AND O.ORDERDATE BETWEEN #{sDate} AND TO_DATE(#{eDate},'YYYY-MM-DD')+0.9999
GROUP BY COUNTRY
</select>
<select id="pieChart" parameterType="com.decolab.wanza.dto.admin.AdminSalesDTO" resultType="com.decolab.wanza.dto.admin.AdminSalesDTO">
SELECT T.MEDIUMCATEGORY AS CATEGORY, SUM(P.QUANTITY) AS QUANTI
FROM PURCHASE_PRODUCT P, PRODUCTION_TAG T, ORDERS O
WHERE P.PRODUCTSEQ = T.PRODUCTSEQ AND P.ORDERSEQ = O.ORDERSEQ AND
O.ORDERDATE >= TO_DATE(#{sDate},'YYYY-MM-DD') AND TO_DATE(#{eDate},'YYYY-MM-DD')+1 >= O.ORDERDATE
GROUP BY T.MEDIUMCATEGORY
</select>

<select id="salesCompare" parameterType="com.decolab.wanza.dto.admin.AdminSalesDTO" resultType="com.decolab.wanza.dto.admin.AdminSalesDTO">
SELECT TO_CHAR(PURCHASEDATE, 'YYYY-MM-DD') AS COMPAREDATE ,COUNT(*) AS COUNT
FROM PURCHASE_PRODUCT
WHERE PURCHASEDATE BETWEEN TO_DATE(#{sDate},'YYYY-MM-DD') AND TO_DATE(#{eDate},'YYYY-MM-DD')+0.9999
GROUP BY TO_CHAR(PURCHASEDATE, 'YYYY-MM-DD') 
ORDER BY TO_CHAR(PURCHASEDATE, 'YYYY-MM-DD')
</select>











</mapper>