<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

  
<mapper namespace="com.decolab.wanza.dao.UserDAO">


<select id="emailCheck" parameterType="java.lang.String" resultType="java.lang.String">
	SELECT EMAIL
	FROM USERS
	WHERE EMAIL=#{email}
</select>

<select id="checkEmail" parameterType="java.lang.String" resultType="java.lang.String">
	SELECT EMAIL
	FROM USERS
	WHERE EMAIL=#{email}
</select>

<select id="phoneCheck" parameterType="com.decolab.wanza.dto.UserDTO" resultType="int">
SELECT NVL(COUNT(*), 0)
FROM USERS
WHERE PHONE=#{phone}
</select>

<select id="nicknameCheck" parameterType="com.decolab.wanza.dto.UserDTO" resultType="int">
SELECT NVL(COUNT(*), 0)
FROM USERS
WHERE NICKNAME=#{nickname}
</select>

<insert id="addUser" parameterType="com.decolab.wanza.dto.UserDTO">
	INSERT INTO USERS(USERSEQ, EMAIL, PWD, USERNAME, NICKNAME, PROFILENAME, PHONE, AUTH, USERDATE, MILEAGE, DEFAULTADDRESS)
	VALUES(SEQ_USER.NEXTVAL, #{email}, #{pwd}, 0, #{nickname}, 0, #{phone}, 0, SYSDATE, 40000, 0)
</insert>

<insert id="kakaologin" parameterType="com.decolab.wanza.dto.UserDTO" >
	MERGE INTO USERS A
	USING (SELECT #{email} AS EMAIL FROM DUAL) B
	ON (A.EMAIL = B.EMAIL)
	WHEN MATCHED THEN
	UPDATE SET A.MILEAGE = A.MILEAGE + 300
	WHEN NOT MATCHED THEN
	INSERT (USERSEQ, EMAIL, PWD, NICKNAME, USERNAME, PROFILENAME, PHONE, AUTH, USERDATE, MILEAGE, DEFAULTADDRESS)
	VALUES(SEQ_USER.NEXTVAL, #{email}, 0, #{nickname}, #{nickname}, 0, 0, 0, SYSDATE, 40000, 0)
</insert>

<select id="klogin" parameterType="com.decolab.wanza.dto.UserDTO" resultType="com.decolab.wanza.dto.UserDTO">
	SELECT USERSEQ, EMAIL, USERNAME, NICKNAME, PROFILENAME, PHONE, AUTH, USERDATE, MILEAGE, DEFAULTADDRESS
	FROM USERS
	WHERE EMAIL=#{email}
</select> 

<select id="login" parameterType="com.decolab.wanza.dto.UserDTO" resultType="com.decolab.wanza.dto.UserDTO">
	SELECT USERSEQ, EMAIL, USERNAME, NICKNAME, PROFILENAME, PHONE, AUTH, USERDATE, MILEAGE, DEFAULTADDRESS
	FROM USERS
	WHERE EMAIL=#{email} AND PWD=#{pwd}
</select>  

<select id="getUserInfo" parameterType="int" resultType="com.decolab.wanza.dto.UserDTO">
	SELECT USERSEQ, EMAIL, PWD, USERNAME, NICKNAME, PROFILENAME, PHONE, USERDATE, MILEAGE, DEFAULTADDRESS
	FROM USERS
	WHERE USERSEQ=#{userSeq}
</select>

<select id="getUserNickname" parameterType="com.decolab.wanza.dto.UserDTO" resultType="com.decolab.wanza.dto.UserDTO">
	SELECT USERSEQ, EMAIL, PWD, USERNAME, NICKNAME, PROFILENAME, PHONE, USERDATE, MILEAGE, DEFAULTADDRESS
	FROM USERS
	WHERE EMAIL=#{email}
</select>

<update id="newPwd" parameterType="com.decolab.wanza.dto.UserDTO">
	UPDATE USERS
	SET PWD = #{pwd}
	WHERE USERSEQ = #{userSeq}
</update>

<select id="getUserEmail" parameterType="com.decolab.wanza.dto.UserDTO" resultType="com.decolab.wanza.dto.UserDTO">
	SELECT USERSEQ, EMAIL, PWD, USERNAME, NICKNAME, PROFILENAME, PHONE, USERDATE, MILEAGE, DEFAULTADDRESS
	FROM USERS
	WHERE PHONE=#{phone}
</select>

<update id="saveUserName" parameterType="com.decolab.wanza.dto.UserDTO">
	UPDATE USERS
	SET USERNAME = #{userName}
	WHERE USERSEQ = #{userSeq}
</update>

  
</mapper>